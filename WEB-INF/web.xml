<web-app xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://java.sun.com/xml/ns/javaee" xsi:schemaLocation="http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd" version="3.0">
	<display-name>camunda bpm webapp</display-name>
	<context-param>
		<param-name>contextConfigLocation</param-name>
		<param-value>/WEB-INF/applicationContext.xml</param-value>
	</context-param>
	<resource-ref>
		<description>ProcessEngineDB Connection</description>
		<res-ref-name>jdbc/ProcessEngineDB</res-ref-name>
		<res-type>javax.sql.DataSource</res-type>
		<res-auth>Container</res-auth>
	</resource-ref>
	<listener>
		<listener-class>org.springframework.web.context.ContextLoaderListener</listener-class>
	</listener>
	<listener>
		<listener-class>com.kpmg.dra.server.ProcessEngineBootstrap</listener-class>
	</listener>
	<listener>
		<listener-class>org.camunda.bpm.cockpit.impl.web.bootstrap.CockpitContainerBootstrap</listener-class>
	</listener>
	<listener>
		<listener-class>org.camunda.bpm.admin.impl.web.bootstrap.AdminContainerBootstrap</listener-class>
	</listener>
	<listener>
		<listener-class>org.camunda.bpm.tasklist.impl.web.bootstrap.TasklistContainerBootstrap</listener-class>
	</listener>
	<session-config>
 		<cookie-config>
  			<secure>true</secure>
 		</cookie-config>
	</session-config>
	<filter>
		<filter-name>MobileDeviceAccessFilter</filter-name>
		<filter-class>com.kpmg.dra.security.MobileDeviceFilter</filter-class>
    </filter>
   	<filter-mapping>
        <filter-name>MobileDeviceAccessFilter</filter-name>
        <url-pattern>/*</url-pattern>
    </filter-mapping>
	<filter>
		<filter-name>httpHeaderSecurity</filter-name>
		<filter-class>org.apache.catalina.filters.HttpHeaderSecurityFilter</filter-class>
		<init-param>
			<param-name>antiClickJackingOption</param-name>
			<param-value>DENY</param-value>
      </init-param>
    </filter>
	<filter-mapping>
        <filter-name>httpHeaderSecurity</filter-name>
        <url-pattern>/*</url-pattern>
        <dispatcher>REQUEST</dispatcher>
    </filter-mapping>
    
  	<filter>
		<filter-name>ApplicationInsightsWebFilter</filter-name>
		<filter-class>com.microsoft.applicationinsights.web.internal.WebRequestTrackingFilter</filter-class>
	</filter>
	<filter-mapping>
		<filter-name>ApplicationInsightsWebFilter</filter-name>
		<url-pattern>/*</url-pattern>
	</filter-mapping>
	
  	<filter>
    	<filter-name>Authentication Filter</filter-name>
    	<filter-class>org.camunda.bpm.webapp.impl.security.auth.AuthenticationFilter</filter-class>
  	</filter>
  	<filter-mapping>
    	<filter-name>Authentication Filter</filter-name>
    	<url-pattern>/app/*</url-pattern>
    	<url-pattern>/api/cockpit/*</url-pattern>
    	<url-pattern>/api/admin/*</url-pattern>
    	<url-pattern>/api/tasklist/*</url-pattern>
    	<url-pattern>/api/engine/*</url-pattern>    
    	<dispatcher>REQUEST</dispatcher>
  	</filter-mapping>
  	<filter>
    	<filter-name>SecurityFilter</filter-name>
    	<filter-class>org.camunda.bpm.webapp.impl.security.filter.SecurityFilter</filter-class>
    	<init-param>
      		<param-name>configFile</param-name>
      		<param-value>/WEB-INF/securityFilterRules.json</param-value>
    	</init-param>
  	</filter>
  	<filter-mapping>
    	<filter-name>SecurityFilter</filter-name>
    	<url-pattern>/app/*</url-pattern>
    	<url-pattern>/api/cockpit/*</url-pattern>
    	<url-pattern>/api/admin/*</url-pattern>
    	<url-pattern>/api/tasklist/*</url-pattern>
    	<url-pattern>/api/engine/*</url-pattern>    
    	<dispatcher>REQUEST</dispatcher>
  	</filter-mapping>
  	<filter>
    	<filter-name>CacheControlFilter</filter-name>
    	<filter-class>org.camunda.bpm.engine.rest.filter.CacheControlFilter</filter-class>
  	</filter>
  	<filter-mapping>
    	<filter-name>CacheControlFilter</filter-name>
		<url-pattern>/api/cockpit/*</url-pattern>
    	<url-pattern>/api/admin/*</url-pattern>
    	<url-pattern>/api/tasklist/*</url-pattern>
    	<url-pattern>/api/engine/*</url-pattern>    
  	</filter-mapping>
  	<filter>
    	<filter-name>Engines Filter</filter-name>
    	<filter-class>org.camunda.bpm.webapp.impl.engine.ProcessEnginesFilter</filter-class>
  	</filter>
  	<filter-mapping>
    	<filter-name>Engines Filter</filter-name>
    	<url-pattern>/app/*</url-pattern>
    	<url-pattern>/api/cockpit/*</url-pattern>
    	<url-pattern>/api/admin/*</url-pattern>
    	<url-pattern>/api/tasklist/*</url-pattern>
    	<url-pattern>/api/engine/*</url-pattern>    
    	<dispatcher>REQUEST</dispatcher>
  	</filter-mapping>
  	<servlet>
    	<servlet-name>Cockpit Api</servlet-name>
    	<servlet-class>org.jboss.resteasy.plugins.server.servlet.HttpServletDispatcher</servlet-class>
    	<init-param>
      		<param-name>javax.ws.rs.Application</param-name>
      		<param-value>org.camunda.bpm.cockpit.impl.web.CockpitApplication</param-value>
    	</init-param>
    	<init-param>
      		<param-name>resteasy.servlet.mapping.prefix</param-name>
      		<param-value>/api/cockpit</param-value>
    	</init-param>
  	</servlet>
  	<servlet-mapping>
    	<servlet-name>Cockpit Api</servlet-name>
    	<url-pattern>/api/cockpit/*</url-pattern>
  	</servlet-mapping>
    <servlet>
        <servlet-name>InitCamunda</servlet-name>
        <servlet-class>com.kpmg.dra.server.InitCamunda</servlet-class>
        <load-on-startup>3</load-on-startup>
    </servlet>
  <servlet>
    <servlet-name>Admin Api</servlet-name>
    <servlet-class>org.jboss.resteasy.plugins.server.servlet.HttpServletDispatcher</servlet-class>
    <init-param>
      <param-name>javax.ws.rs.Application</param-name>
      <param-value>org.camunda.bpm.admin.impl.web.AdminApplication</param-value>
    </init-param>
    <init-param>
      <param-name>resteasy.servlet.mapping.prefix</param-name>
      <param-value>/api/admin</param-value>
    </init-param>
  </servlet>
  <servlet-mapping>
    <servlet-name>Admin Api</servlet-name>
    <url-pattern>/api/admin/*</url-pattern>
  </servlet-mapping>
  <servlet>
    <servlet-name>Tasklist Api</servlet-name>
    <servlet-class>org.jboss.resteasy.plugins.server.servlet.HttpServletDispatcher</servlet-class>
    <init-param>
      <param-name>javax.ws.rs.Application</param-name>
      <param-value>org.camunda.bpm.tasklist.impl.web.TasklistApplication</param-value>
    </init-param>
    <init-param>
      <param-name>resteasy.servlet.mapping.prefix</param-name>
      <param-value>/api/tasklist</param-value>
    </init-param>
  </servlet>
  <servlet-mapping>
    <servlet-name>Tasklist Api</servlet-name>
    <url-pattern>/api/tasklist/*</url-pattern>
  </servlet-mapping>
  <servlet>
    <servlet-name>Engine Api</servlet-name>
    <servlet-class>org.jboss.resteasy.plugins.server.servlet.HttpServletDispatcher</servlet-class>
    <init-param>
      <param-name>javax.ws.rs.Application</param-name>
      <param-value>org.camunda.bpm.webapp.impl.engine.EngineRestApplication</param-value>
    </init-param>
    <init-param>
      <param-name>resteasy.servlet.mapping.prefix</param-name>
      <param-value>/api/engine</param-value>
    </init-param>
  </servlet>
  <servlet-mapping>
    <servlet-name>Engine Api</servlet-name>
    <url-pattern>/api/engine/*</url-pattern>
  </servlet-mapping>
  <servlet>
    <servlet-name>Login</servlet-name>
    <servlet-class>com.kpmg.dra.security.LoginServlet</servlet-class>
  </servlet>
  <servlet-mapping>
    <servlet-name>Login</servlet-name>
    <url-pattern>/login</url-pattern>
  </servlet-mapping>
  <filter>
    <filter-name>DRA Authentication Filter</filter-name>
    <filter-class>com.kpmg.dra.security.AuthenticationFilter</filter-class>
  </filter>
  <filter-mapping>
    <filter-name>DRA Authentication Filter</filter-name>
    <url-pattern>/api/dra/*</url-pattern>
    <dispatcher>REQUEST</dispatcher>
  </filter-mapping>
  <filter>
    <filter-name>ExpiresFilter</filter-name>
    <filter-class>org.apache.catalina.filters.ExpiresFilter</filter-class>
    <init-param>
      <param-name>ExpiresByType image</param-name>
      <param-value>modification plus 0 minutes</param-value>
    </init-param>
    <init-param>
      <param-name>ExpiresByType text/css</param-name>
      <param-value>modification plus 0 minutes</param-value>
    </init-param>
    <init-param>
      <param-name>ExpiresByType application/javascript</param-name>
      <param-value>modification plus 0 minutes</param-value>
    </init-param>
  </filter>
  <filter-mapping>
    <filter-name>ExpiresFilter</filter-name>
    <url-pattern>/*</url-pattern>
    <dispatcher>REQUEST</dispatcher>
  </filter-mapping>
  <servlet>
    <servlet-name>Network Api</servlet-name>
    <servlet-class>org.glassfish.jersey.servlet.ServletContainer</servlet-class>
    <init-param>
      <param-name>javax.ws.rs.Application</param-name>
      <param-value>com.kpmg.dra.rest.IGR</param-value>
    </init-param>
    <init-param>
      <param-name>readonly</param-name>
      <param-value>false</param-value>
    </init-param>
    <init-param>  
    	<param-name>jersey.config.server.provider.classnames</param-name>  
    	<param-value>org.glassfish.jersey.filter.LoggingFilter;  
     	org.glassfish.jersey.media.multipart.MultiPartFeature</param-value>  
	</init-param>  
    <load-on-startup>1</load-on-startup>
  </servlet>
  <servlet-mapping>
    <servlet-name>Network Api</servlet-name>
    <url-pattern>/api/dra/*</url-pattern>
  </servlet-mapping>
  <error-page>
    <exception-type>java.lang.Throwable</exception-type>
    <location>/dra-app/error.jsp</location>  
</error-page> 
	<error-page>
		<error-code>404</error-code>
		<location>/dra-app/error.jsp</location>
	</error-page>
	<error-page>
		<error-code>401</error-code>
		<location>/dra-app/error.jsp</location>
	</error-page>
	<error-page>
		<error-code>403</error-code>
		<location>/dra-app/error.html</location>
	</error-page>
	<error-page>
		<error-code>500</error-code>
		<location>/dra-app/error.html</location>
	</error-page>
</web-app>